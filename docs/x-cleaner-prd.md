# ⭐ X Cleaner - 产品需求文档（v1.0 发布版）

## 📌 1. 产品目标

为 X（Twitter）用户减少低价值内容干扰，使信息浏览更高效。  
通过 DOM 过滤方式隐藏短文本及不需要的推文类型。

**一句话产品定位：**  
> 为你的时间线瘦身，屏蔽噪音，让内容更有营养。

---

## 🎯 2. 使用场景与核心价值

| 场景 | 用户痛点 | 插件提供的价值 |
|------|----------|----------------|
| 刷 X 想获取信息 | 推文太多废话、字数太少 | 隐藏短文本内容 |
| 想专注某种信息形式 | 视频/图片掺杂太多 | 媒体类型过滤 |
| 只想看中文或英文 | 语言混杂降低可读性 | 语言过滤 |
| 只想看高互动内容 | 低质量内容刷屏 | 互动量过滤 |

---

## 🧩 3. 功能定义（v1.0 已实现）

### 3.1 模式切换（互斥）

| 模式 | 描述 |
|------|------|
| 原始模式 | 不进行任何过滤，显示全部内容 |
| 精简模式（默认） | 应用全部过滤规则 |

---

### 3.2 过滤规则（精简模式下可选叠加）

| 规则 | 控件类型 | 默认值 | 状态 |
|------|----------|--------|------|
| 隐藏短文本（中<45字 或 英<30词） | Checkbox | OFF | ✅ 已实现 |
| 只显示带图推文 | Checkbox | OFF | ✅ 已实现 |
| 只显示带视频推文 | Checkbox | OFF | ✅ 已实现 |
| 只显示带图+视频推文 | Checkbox | OFF | ✅ 已实现 |
| 语言过滤：全部/仅中文/仅英文 | Dropdown | 全部 | ✅ 已实现 |
| 互动量过滤：浏览量/点赞/转发 | 数字输入 | 0 | ✅ 已实现 |

**过滤逻辑说明：**
- 多个条件可叠加使用
- 媒体过滤：图片+视频选项使用 OR 逻辑（有图片或有视频即显示）
- 互动量过滤：只有当提取成功（值>0）时才应用过滤

---

### 3.3 未实现功能（后续版本）

| 功能 | 计划版本 |
|------|----------|
| 账号白名单 | v1.5 |
| 关键词过滤 | v1.5 |
| 折叠而非隐藏 | v2.0 |
| 广告过滤 | v2.0 |

---

## 🧠 4. 技术实现

### 4.1 架构特点（v2）

- **WeakMap 缓存**：避免重复提取推文数据
- **状态标记**：pending/done 两段式，永不重复处理
- **防抖通知**：1秒防抖减少闪烁
- **visibility 隐藏**：使用 visibility+height:0 保持布局稳定

### 4.2 Tweet 节点定位

```css
article[data-testid="tweet"]
```

### 4.3 特征判断

| 特征 | 判断方式 |
|------|----------|
| 文本内容 | `[data-testid="tweetText"]` |
| 图片存在 | `[data-testid="tweetPhoto"]` |
| 视频存在 | `[data-testid="videoPlayer"]` 或 `<video>` |
| 中文判定 | Unicode Han 匹配 + 占比>40% |
| 互动量 | 解析 `[role="group"] [role="button"]` 的 aria-label |

### 4.4 媒体检测延迟

由于 X 懒加载媒体元素，使用 300ms 延迟后再检测。

---

## ⚙️ 5. 技术规范

| 项目 | 说明 |
|------|------|
| Content Script | `content.js` 注入 X 页面 |
| DOM 监听 | MutationObserver 监听新增推文 |
| 存储 | chrome.storage.sync 同步设置 |
| 处理标记 | `data-x-processed="pending/done"` |
| 权限 | 仅 `https://x.com/*` |

---

## 🎨 6. Popup UI

```
------------------------------------
| X Cleaner            [精简模式]   |
------------------------------------
模式：
( ) 原始模式
(●) 精简模式

过滤规则：
☑ 隐藏短文本（中 < 45 / 英 < 30）
▢ 只显示带图推文
▢ 只显示带视频推文
▢ 只显示图+视频推文

语言过滤：
[ 全部 ▼ ]

互动量过滤：
设置互动量区间 (0表示不限制)
浏览量 [__] - [__]
点赞数 [__] - [__]
转发数 [__] - [__]

[ 保存设置 ]
------------------------------------
```

---

## 📋 7. 验收标准

| 项目 | 标准 |
|------|------|
| 功能正确性 | 过滤规则准确生效 |
| 性能表现 | 滚动流畅，无明显卡顿 |
| 模式切换 | 设置即时生效 |
| 稳定性 | 无闪烁、无页面跳动 |
| 隐私安全 | 不收集/上传任何用户数据 |

---

## 📊 8. 版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| v1.0.0 | 2025-12-16 | 首次发布：模式切换、短文本过滤、媒体过滤、语言过滤、互动量过滤 |